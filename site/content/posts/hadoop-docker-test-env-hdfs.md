---
author: "Kim, Geunho"
date: 2019-08-28
draft: true
title: "Docker로 Hadoop 테스트 환경 구축하기 - HDFS"
---

# Docker와 테스트 환경
Docker는 애플리케이션을 컨테이너화해서 이미지로 만들어 배치하고 실행할 수 있는 환경을 제공하는 컨테이너 도구[^1]이다.  
격리된 파일 시스템을 갖는 컨테이너 특성 덕분에, 운영 환경에 대한 프로비져닝 뿐만 아니라 Docker가 설치된 환경에서 컨테이너화된 애플리케이션을 즉시 구동시켜서 테스트할 수 있는 환경을 구성하는데에도 유용하게 쓰인다.  

오픈소스를 포함한 다양한 애플리케이션을 로컬 환경에 설치하고 구성하면서 테스트하다보면(주로 개발자의 노트북), 어느새 로컬 환경은 지저분해지고 몇 해 전에 설치한 애플리케이션이 자동 재시작되어 리소스를 점유하게 된다. 환경 설정 파일은 언제 어떻게 바꿨는지도 모른다. VM 환경으로 OS를 완전히 격리시켜 구성하자니 구동하는데 시간이 오래 걸리고 구동한 이후 점유하는 리소스가 노트북이 감당하기에는 참 크다.  

Docker는 이런 환경에서 최적의 도구이다. 컨테이너를 어떻게 구성할지 애플리케이션마다 설정 파일을 생성하고, 서로 상호작용하는 애플리케이션인 경우 다시 실행과 관련된 설정 파일을 생성해서 여러 개의 애플리케이션을 순식간에 실행하고 다시 종료시킬 수 있다.  

이 포스트에서는 Hadoop HDFS를 Docker로 컨테이너화 헤서 로컬에 테스트 환경으로 구성하는 방법을 설명한다.  

<br/>
# HDFS
하둡 분산 파일 시스템(HDFS)은 마스터 노드인 [NameNode](/posts/hadoop-namenode)와 워커 노드인 [DataNode](/posts/hadoop-datanode)로 이루어져있다. 각각 JVM 위에서 동작하는 자바 애플리케이션으로, 두 애플리케이션만 동작을 하면 HDFS를 구성해서 읽고 쓸 수 있다.  
실행 환경은 일반적은 GNU/Linux 그리고 Windows 환경을 지원하며, Hadoop 2.7~2.x[^2] 버전은 Java 7, 8을 지원한다.[^3]  

클라이언트에서 각 애플리케이션과 직접 통신하는 포트 정보는 다음 표와 같다.

| 애플리케이션 &nbsp;&nbsp; | 기본포트 &nbsp;&nbsp; | 프로토콜 &nbsp;&nbsp; | 상세설명                               | 관련 설정 항목                  |
|------------------------|---------------------|--------------------|--------------------------------------|-----------------------------|
| NameNode               | 50070               | HTTP                | HDFS 상태 및 파일 시스템 조회용 Web UI &nbsp;   | `dfs.http.address`    |
|                        | 9000                | IPC                 | 파일 시스템 메타데이터 관련 작업용          | `fs.defaultFS`              |
| DataNode               | 50075               | HTTP                | 상태 및 로그 조회용 Web UI              | `dfs.datanode.http.address` |
|                        | 50010               | TCP                 | 데이터 전송                            | `dfs.datanode.address`      |
_표 1. 클라이언트에서 HDFS와 직접 통신할 때 사용하는 포트 정보_

이 자료들을 가지고 이제 본격적으로 Docker 컨테이너화를 진행해보자.

<br/>
# Dockerize
애플리케이션을 Docker에서 사용하는 설정 파일인 `Dockerfile` 양식에 맞게 구성한다. 이 설정 파일이 있으면 Docker 이미지 빌드가 가능하고, 생성한 이미지를 어디에서든 당겨와서(pull) 실행할 수 있다.  
사실 이미지를 생성하는 것은 이 설정 파일 없이 직접 기반이 되는 OS 이미지로부터 컨테이너를 실행해서 쉘로 접속, 필요한 작업을 하고 이미지를 커밋해도 된다. 하지만 이 방식은 다음과 같은 문제점이 있다: 
* 이미지가 어떻게 생성되었는지 기록이 남지 않음
* 따라서 작업한 내용을 다시 되돌리거나, 몇 가지 설정을 변경해서 새로운 이미지를 생성하기 어려움
* 그리고 생성된 이미지를 신뢰하기 어려움. 따라서 다른 사람과 공유하는데에도 적합하지 않음
블럭을 쌓아 올리듯 이미지를 만드는 Docker 세계에서는, 처음에는 조금 번거로워 보이더라도 `Dockerfile`로 이미지를 만드는 것에 익숙해지도록 한다. 

## NameNode
## DataNode
## Proxy


[^1]: Docker 공식 홈페이지의 [What is a Container?](https://www.docker.com/resources/what-container)를 참고한다.
[^2]: 이 글을 작성하는 시점의 Hadoop 2 최신 버전인 2.9.2 버전의 공식 문서를 참고했다.
[^3]: 그 외 지원 버전은 Hadoop confluence 페이지의 [Hadoop Java Versions](https://cwiki.apache.org/confluence/display/HADOOP/Hadoop+Java+Versions)를 참고한다.