---
author: "Kim, Geunho"
date: 2019-11-11
draft: true
title: "관제에서 평균값, 중앙값, 그리고 백분위"
---

# 평균값(mean)의 문제

어떤 서비스의 관제 시스템은 지표를 1초 단위로 시계열 저장소에 수집한다고 가정해보자.

지표들을 시계열 그래프의 차트로 나타낸다면, 최근 한 시간 추이만 보려고 해도 하나의 지표당 3600개(1시간 = 3600초)의 데이터 포인트를 데이터베이스에서 조회하고 화면에 그려야 한다.
대부분의 시계열 저장소에서는 이를 위해 조회시 집계를 할 수 있도록 함수를 제공하고 있다.

일반적으로 많이 사용하는 것은 n초(혹은 분)간 평균값(mean)인데, CPU, RAM, Disk 등 서버 한 대에서 수집하는 리소스의 평균값은 대표값으로 사용하는데 큰 문제가 없다.
(시간에 따른 값의 편차가 크지 않고 일시적으로 튄 데이터 포인트는 서버에 큰 위협이 없기 때문)

그런데 만약 요청 응답 시간과 같은 수치를 평균값으로 집계해서 그리면 어떻게 될까?

응답 시간이라는 하나의 지표이지만 다양한 클라이언트로부터 요청을 받아 처리하고, 응답을 보내는데까지 걸리는 시간은 클라이언트마다 편차가 클 것이다.
편차가 크면 수치가 고르게 분포되어 있지 않을 것이고 특정 구간에서 크게 튀는 값들은 적당한 값으로 다운샘플링 될것이다.
이렇게 되면 일부 클라이언트에서 발생하는 높은 지연 시간을 알아차리지 못할 수 있다.

이렇듯 일부 항목에 대해서 발생하는 이상 현상을 관제시 놓치지 않으려면 백분위수(percentile)을 이용해야 한다.

# 백분위수(percentile)
